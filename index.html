<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Marathi Crime Files</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f6f7fb;color:#0b2540;}
header{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:#1e40af;color:white;position:sticky;top:0;z-index:300;box-shadow:0 2px 5px rgba(0,0,0,0.2);}
header h1{font-size:20px;font-weight:bold;}
header .buttons button{margin-left:6px;padding:6px 12px;border-radius:6px;cursor:pointer;color:white;}
.posts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px;padding:8px;margin-top:16px;}
.card{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 6px 20px rgba(2,6,23,0.06);cursor:pointer;transition:transform 0.2s;position:relative;}
.card:hover{transform:scale(1.02);}
.card img{width:100%;height:150px;object-fit:cover;cursor:zoom-in;transition:transform 0.3s;}
.card-body{padding:8px;}
.card-body h3{font-weight:700;font-size:18px;margin-bottom:4px;}
.card-body p{font-size:14px;color:#555;margin-bottom:6px;}
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:400;overflow:auto;}
.modal{background:#fff;border-radius:10px;max-width:650px;width:90%;max-height:85%;overflow-y:auto;padding:16px;position:relative;}
.modal img{max-width:100%;border-radius:10px;margin-bottom:6px;}
.modal-close{position:absolute;top:10px;right:15px;background:#fff;border:none;border-radius:50%;padding:5px 10px;cursor:pointer;font-weight:bold;}
.editor{padding:12px;background:#fff;margin:6px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.editor input,.editor textarea{border:1px solid #ccc;border-radius:6px;padding:6px;margin-bottom:6px;width:100%;}
.editor button{padding:6px 12px;margin-right:6px;border-radius:6px;background:#1e40af;color:white;cursor:pointer;}
</style>
</head>
<body>

<header>
  <h1>Marathi Crime Files</h1>
  <div class="buttons">
    <button id="loginBtn" class="bg-green-500">Login</button>
    <button id="logoutBtn" class="bg-red-600 hidden">Logout</button>
  </div>
</header>

<section id="editorArea" class="editor hidden">
  <h2>üñãÔ∏è Admin Panel</h2>
  <input id="postTitle" placeholder="Title">
  <textarea id="postDesc" placeholder="Short Description"></textarea>
  <input type="file" id="postImage">
  <button id="publishBtn">Publish</button>
  <p id="status"></p>
</section>

<section class="posts-grid" id="postsArea"></section>

<div id="modalBg" class="modal-bg">
  <div class="modal">
    <button id="modalClose" class="modal-close">X</button>
    <div id="modalContent"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

// ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "AIzaSyCLCUAiPz-sqhFDskG9g9AwyUI1RdTQWfk",
  authDomain: "marathi-crime-files.firebaseapp.com",
  projectId: "marathi-crime-files",
  storageBucket: "marathi-crime-files.appspot.com",
  messagingSenderId: "973325762370",
  appId: "1:973325762370:web:4fb97306806bbe6cc0d2db",
  measurementId: "G-1XQPKL3740"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);
const storage = getStorage(app);

const ADMIN_EMAIL = "gulistankh20141@gmail.com";

// DOM elements
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const editorArea = document.getElementById("editorArea");
const postTitle = document.getElementById("postTitle");
const postDesc = document.getElementById("postDesc");
const postImage = document.getElementById("postImage");
const publishBtn = document.getElementById("publishBtn");
const status = document.getElementById("status");
const postsArea = document.getElementById("postsArea");
const modalBg = document.getElementById("modalBg");
const modalClose = document.getElementById("modalClose");
const modalContent = document.getElementById("modalContent");

// Login / Logout
loginBtn.onclick = async () => { await signInWithPopup(auth, provider); };
logoutBtn.onclick = async () => { await signOut(auth); };

// Auth state
onAuthStateChanged(auth, user => {
  if(user && user.email.toLowerCase()===ADMIN_EMAIL.toLowerCase()){
    editorArea.classList.remove("hidden");
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";
  } else {
    editorArea.classList.add("hidden");
    loginBtn.style.display = "inline-block";
    logoutBtn.style.display = "none";
  }
});

// Publish post
publishBtn.onclick = async () => {
  const title = postTitle.value.trim();
  const desc = postDesc.value.trim();
  const file = postImage.files[0];
  if(!title) return alert("Enter title!");
  status.innerText = "Publishing...";

  let imgUrl = "";
  if(file){
    const filename = `posts/${Date.now()}_${file.name}`;
    const storageRef = sRef(storage, filename);
    const uploadTask = uploadBytesResumable(storageRef, file);
    await new Promise((res, rej) => {
      uploadTask.on('state_changed', null, err=>rej(err), ()=>res());
    });
    imgUrl = await getDownloadURL(uploadTask.snapshot.ref);
  }

  await addDoc(collection(db,"crimes"),{
    title, desc, imgUrl, createdAt: serverTimestamp()
  });

  postTitle.value = "";
  postDesc.value = "";
  postImage.value = "";
  status.innerText = "Published ‚úÖ";
  loadPosts();
};

// Load posts
async function loadPosts(){
  postsArea.innerHTML="";
  const snap = await getDocs(collection(db,"crimes"));
  snap.forEach(docSnap=>{
    const data = docSnap.data();
    const card = document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <img src="${data.imgUrl||'https://via.placeholder.com/300x200?text=No+Image'}">
      <div class="card-body">
        <h3>${data.title}</h3>
        <p>${data.desc||''}</p>
      </div>
    `;
    card.onclick = async ()=>{
      const d = await getDoc(doc(db,"crimes",docSnap.id));
      modalContent.innerHTML=`<h2 class="text-lg font-bold mb-2">${d.data().title}</h2><p>${d.data().desc||''}</p>`;
      if(d.data().imgUrl) modalContent.innerHTML+=`<img src="${d.data().imgUrl}" style="width:100%;border-radius:6px;margin-top:6px;">`;
      modalBg.style.display="flex";
    };
    postsArea.appendChild(card);
  });
}

modalClose.onclick = ()=>{ modalBg.style.display="none"; };
modalBg.onclick = e => { if(e.target===modalBg) modalBg.style.display="none"; };

loadPosts();
</script>

</body>
</html>
